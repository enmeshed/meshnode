// Log to OpenTracing when a trace is active.
import { LogWriter, LogMiddleware } from './logging'
import { getContext } from '../globalContext'

export class OpenTracingLogWriter extends LogWriter:
  writeToLog(data): void ->
    ctx = getContext()
    span = ctx.openTracingSpan
    if not span: return

    rec = Object.assign({}, data)
    time = rec.time
    rec.level = LogMiddleware.levelNumberToName(rec.level)
    delete rec.time

    span.log(rec, time)

    Promise.resolve(undefined)
